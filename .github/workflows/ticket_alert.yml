name: CL Hospitality Ticket Alert

on:
  schedule:
    - cron: "0 17 * * *"   # 9AM  PST
    - cron: "0 18 * * *"   # 10AM PST
    - cron: "0 19 * * *"   # 11AM PST
    - cron: "0 20 * * *"   # 12PM PST
    - cron: "0 21 * * *"   # 1PM  PST
    - cron: "0 22 * * *"   # 2PM  PST
    - cron: "0 23 * * *"   # 3PM  PST
    - cron: "0 0  * * *"   # 4PM  PST
    - cron: "0 1  * * *"   # 5PM  PST
  workflow_dispatch:        # manual trigger from GitHub UI

permissions:
  contents: write           # needed to commit prices.json back to repo

jobs:
  scrape-and-publish:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: pip

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Install Playwright browsers
        run: playwright install chromium --with-deps

      - name: Scrape prices
        run: python run_once.py

      # Commit the updated prices.json back to the repo
      # GitHub Pages then serves the new data automatically
      - name: Commit updated prices
        run: |
          git config user.name  "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add docs/data/prices.json
          git diff --cached --quiet || git commit -m "chore: update prices [skip ci]"
          git push
